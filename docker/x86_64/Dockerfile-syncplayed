FROM golang:1.20 AS builder
WORKDIR /src
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -ldflags='-s -w' -o /syncplayed

FROM debian:11

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    ca-certificates-java \
    && rm -rf /var/lib/apt/lists/*

# Copy binary
COPY --from=builder /syncplayed /usr/local/bin/syncplayed

RUN chmod +x /usr/local/bin/syncplayed

ENV A_HOST="" \
    A_USER="" \
    A_TOKEN="" \
    B_HOST="" \
    B_USER="" \
    B_TOKEN="" \
    DRY_RUN="true" \
    INTERVAL="24h"

# Run the binary directly; it will loop and sleep between runs (default 24h).
CMD ["/usr/local/bin/syncplayed"]
